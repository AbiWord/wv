EXEEXT = @EXEEXT@

LDFLAGS = @LDFLAGS@

#Some Users might have problems with linking against -lz, this is because there is probably an
#old version of it hanging around in the X dirs, you can add -L/usr/lib to the begging of there 
#options to fix it.
#LIBS = -L/usr/lib  @ZLIB_LIBS@ @LIBS@ @WMF_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ -lm
LIBS =  @ZLIB_LIBS@ @LIBS@ @WMF_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ -lm

GETOPT = @LIBOBJS@

ICONV = @ICONV@

RICONVOBJS = \
iconv/codepage-874.o 	\
iconv/codepage-1250.o 	\
iconv/codepage-1251.o 	\
iconv/codepage-1254.o 	\
iconv/codepage-1257.o 	\
iconv/codepage-1252.o 	\
iconv/codepage-1255.o 	\
iconv/codepage-1253.o 	\
iconv/codepage-1256.o 	\
iconv/koi8-r.o 			\
iconv/iso-8859-15.o		\
iconv/tis-620.o			\
iconv/utf-8.o			\
iconv/iconv.o

ICONVOBJS =  @ICONVOBJS@


#abi's picky warning checks
#CC = @CC@ -Wall -W -ansi -pedantic

CC = @CC@

LEX = @LEX@

SHELL=/bin/sh

RANLIB = @RANLIB@

AR = ar

LN = ln

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

@SET_MAKE@

prefix=@prefix@
exec_prefix=@exec_prefix@
srcdir=@srcdir@
bindir=@bindir@
libdir=@libdir@
mandir=@mandir@
includedir = @includedir@
PERL = @PERL@

VPATH = @srcdir@

CFLAGS = @CFLAGS@ @DEFS@ @ZLIB_CFLAGS@ -I. -I./ -I$(srcdir)/ -I$(srcdir)/iconv/ -I$(srcdir)/expat/xmlparse/ -I$(srcdir)/oledecod/  @TTF_CFLAGS@ @WMF_CFLAGS@ -DTTFDIR=\"$(libdir)/wv/ttf\" -DXMLCONFIG=\"$(libdir)/wv/wvConfig.xml\" -DHTMLCONFIG=\"$(libdir)/wv/wvHtml.xml\" 

MKINSTALLDIRS = $(srcdir)/mkinstalldirs

SHELL = /bin/sh

.SUFFIXES: .C .o

MYOBJECTS =	\
	laolareplace.old.o \
	support.o \
	list.o \
	piecetable.o \
	stylesheet.o \
	sprm.o \
	blip.o \
	utf.o \
	field.o \
	formatting.o \
	references.o \
	gpprl.o \
	papchpsep.o \
	hyperlink.o \
	decompresswmf.o \
	annotations.o \
	dop.o \
	roman.o \
	fib.o \
	frd.o \
	atrd.o \
	sed.o \
	font.o \
	ffn.o \
	fld.o \
	bkf.o \
	dttm.o \
	generic.o \
	error.o \
	unicode.o \
	sttbf.o \
	xst.o \
	fspa.o \
	lst.o \
	lvl.o \
	lfo.o \
	nfc.o \
	ordinal.o \
	summary.o \
	filetime.o \
	chp.o \
	brc.o \
	anld.o \
	shd.o \
	dcs.o \
	numrm.o \
	asumyi.o \
	version.o \
	lspd.o \
	phe.o \
	tlp.o \
	tc.o \
	tap.o \
	pap.o \
	bintree.o \
	decode_simple.o \
	pcd.o \
	prm.o \
	clx.o \
	bte.o \
	bx.o \
	fkp.o \
	codepage-1252.o \
	text.o \
	decode_complex.o \
	wvTextEngine.o \
	wvHtmlEngine.o \
	wvConfig.o \
	wvparse.o \
	reasons.o \
	sep.o \
	anlv.o \
	olst.o \
	asumy.o \
	bkd.o \
	bkl.o \
	dogrid.o \
	doptypography.o \
	pgd.o \
	rs.o \
	rr.o \
	tbd.o \
	ftxbxs.o \
	wkb.o \
	graphics.o \
	picf.o \
	crc32.o \
	md5.o \
	rc4.o \
	decrypt97.o \
	decrypt95.o \
	twips.o \
	table.o \
	symbol.o

#XML = -Lexpat/lib -lxmlparse -lxmltok
XML = 	expat/xmlparse/xmlparse.o \
    	expat/xmlparse/hashtable.o \
		expat/xmltok/xmltok.o \
    	expat/xmltok/xmlrole.o

OLE = oledecod/oledecod.o

all: wvSummary$(EXEEXT) wvHtml$(EXEEXT) wvConvert$(EXEEXT) wvText$(EXEEXT) wvSimpleCLX$(EXEEXT) wvVersion$(EXEEXT) wv-libconfig wv-incconfig

wvSummary$(EXEEXT): wvSummary.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvSummary.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wvSimpleCLX$(EXEEXT): wvSimpleCLX.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvSimpleCLX.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wvVersion$(EXEEXT): wvVersion.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvVersion.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wvConvert$(EXEEXT): wvConvert.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvConvert.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wvText$(EXEEXT): wvConvert$(EXEEXT)
	$(LN) -s wvConvert$(EXEEXT) wvText$(EXEEXT)

wvHtml$(EXEEXT): wvHtml.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvHtml.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wvGraphicConvert$(EXEEXT): wvGraphicConvert.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ wvGraphicConvert.o $(GETOPT) -L. -lwv $(LIBS) $(LDFLAGS)

wv-libconfig: Makefile
	rm -f wv-libconfig
	echo \#\!/bin/sh > wv-libconfig
	echo echo -L$(libdir) -lwv $(LIBS) $(LDFLAGS) >> wv-libconfig

wv-incconfig: Makefile
	rm -f wv-incconfig
	echo \#\!/bin/sh > wv-incconfig
	echo echo @ZLIB_CFLAGS@ -I$(includedir) @WMF_CFLAGS@ >> wv-incconfig

lex.yy.c: parser.lex
	$(LEX) parser.lex

testparse$(EXEEXT):  testparse.o $(GETOPT) OLEDECODE libwv.a
	$(CC)  -o $@ testparse.o $(GETOPT) -L. -lwv $(LIBS)  $(LDFLAGS)

error.o: $(srcdir)/error.c Makefile
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c 

laolareplace.o: $(srcdir)/laolareplace.c 
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c 

libwv.a:	$(MYOBJECTS) XMLPARSER $(ICONV)
	$(AR) rc $@ $(MYOBJECTS) $(ICONVOBJS) $(XML)
	$(RANLIB) $@

ICONV:
	@echo making iconv in iconv
	@(cd iconv && $(MAKE)) || exit 1

OLEDECODE:
	@echo making oledecod in oledecod
	@(cd oledecod && $(MAKE)) || exit 1

XMLPARSER:
	@echo making expat in expat
	@(cd expat && $(MAKE)) || exit 1

%.o: $(srcdir)/%.c 
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c 

cleansub:
	@echo cleaning oledecod in oledecod
	@(cd oledecod && $(MAKE) clean) || exit 1
	@echo cleaning expat in expat
	@(cd expat && $(MAKE) clean) || exit 1
	@echo cleaning iconv in iconv 
	@(cd iconv && $(MAKE) clean) || exit 1

clean: cleansub
	rm -rf *.o $(GETOPT) wvHtml$(EXEEXT) wvConvert$(EXEEXT) wvText$(EXEEXT) wvSummary$(EXEEXT) wvVersion$(EXEEXT) wvSimpleCLX$(EXEEXT) wvGraphicConvert$(EXEEXT) core a.out *.a

distclean: realcleansub
	rm -rf analyze config.cache config.status config.log Makefile config.h *.a *.o wv-incconfig wv-libconfig wvSummary$(EXEEXT) wvVersion$(EXEEXT) wvSimpleCLX$(EXEEXT) wvHtml$(EXEEXT) wvConvert$(EXEEXT) wvText$(EXEEXT) wvGraphicConvert$(EXEEXT) core out* analyze/* .pure

realclean: distclean
	rm -rf lex.yy.c

realcleansub:
	@echo real cleaning oledecod in oledecod
	@(cd oledecod && $(MAKE) realclean) || exit 1
	@echo real cleaning expat in expat
	@(cd expat && $(MAKE) realclean) || exit 1
	@echo real cleaning iconv in iconv 
	@(cd iconv && $(MAKE) realclean) || exit 1

installdirs:
	$(MKINSTALLDIRS) $(bindir) \
	$(mandir) \
	$(mandir)/man1 \
	$(libdir) \
	$(libdir)/wv\
	$(libdir)/wv/wingdingfont \
	$(libdir)/wv/patterns \
	$(libdir)/wv/ttf \
	$(includedir)
	

install: installdirs all
	$(INSTALL) $(srcdir)/wvSummary$(EXEEXT) $(bindir)/wvSummary$(EXEEXT)
	$(INSTALL) $(srcdir)/wvSimpleCLX$(EXEEXT) $(bindir)/wvSimpleCLX$(EXEEXT)
	$(INSTALL) $(srcdir)/wvVersion$(EXEEXT) $(bindir)/wvVersion$(EXEEXT)
	$(INSTALL) $(srcdir)/wvConvert$(EXEEXT) $(bindir)/wvConvert$(EXEEXT)
	$(RM) $(bindir)/wvText$(EXEEXT)
	$(LN) -s $(bindir)/wvConvert$(EXEEXT) $(bindir)/wvText$(EXEEXT)
	$(INSTALL) $(srcdir)/wvHtml$(EXEEXT) $(bindir)/wvHtml$(EXEEXT)
	$(INSTALL) $(srcdir)/wv-libconfig $(bindir)/wv-libconfig
	$(INSTALL) $(srcdir)/wv-incconfig $(bindir)/wv-incconfig
	$(INSTALL_DATA) $(srcdir)/wvHtml.1 $(mandir)/man1/
	$(INSTALL_DATA) wv.h $(includedir)/wv.h
	$(INSTALL_DATA) $(srcdir)/libwv.a $(libdir)/libwv.a
	$(INSTALL_DATA) $(srcdir)/wvHtml.xml $(libdir)/wv/wvHtml.xml
	$(INSTALL_DATA) $(srcdir)/wvConfig.xml $(libdir)/wv/wvConfig.xml
	for filename in wingdingfont/*.gif; do \
		$(INSTALL_DATA) $$filename $(libdir)/wv/wingdingfont; \
	done
	for filename in patterns/*.gif patterns/*.jpg; do \
		$(INSTALL_DATA) $$filename $(libdir)/wv/patterns; \
	done



#  DO  NOT  DELETE THIS LINE -- make depend depends on it.
